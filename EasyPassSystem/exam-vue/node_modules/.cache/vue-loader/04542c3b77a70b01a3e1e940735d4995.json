{"remainingRequest":"D:\\BaiduDownload\\projectmass\\exam-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\BaiduDownload\\projectmass\\exam-vue\\src\\views\\teacher\\MarkManage.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\BaiduDownload\\projectmass\\exam-vue\\src\\views\\teacher\\MarkManage.vue","mtime":1682044119000},{"path":"D:\\BaiduDownload\\projectmass\\exam-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686540617114},{"path":"D:\\BaiduDownload\\projectmass\\exam-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1686540617613},{"path":"D:\\BaiduDownload\\projectmass\\exam-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686540617114},{"path":"D:\\BaiduDownload\\projectmass\\exam-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1686540616128}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBleGFtIGZyb20gJ0AvYXBpL2V4YW0nCmltcG9ydCB1c2VyIGZyb20gJ0AvYXBpL3VzZXInCmltcG9ydCBjb25zdGFudHMgZnJvbSAnQC91dGlscy9jb25zdGFudHMnCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ01hcmtNYW5hZ2UnLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBxdWVyeUluZm86IHsKICAgICAgICBwYWdlTm86IDEsCiAgICAgICAgcGFnZVNpemU6IDEwCiAgICAgIH0sCiAgICAgIC8v6ICD6K+V6K6w5b2VCiAgICAgIGV4YW1SZWNvcmRzOiBbXSwKICAgICAgLy/ooajmoLzmlbDmja7liqDovb0KICAgICAgbG9hZGluZzogdHJ1ZSwKICAgICAgLy/miYDmnInogIPor5Xkv6Hmga8KICAgICAgYWxsRXhhbUluZm86IFtdLAogICAgICAvL+aAu+aVsAogICAgICB0b3RhbDogMAogICAgfQogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0RXhhbVJlY29yZHMoKQogICAgdGhpcy5nZXRBbGxFeGFtSW5mbygpCiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBnZXRFeGFtUmVjb3JkcygpIHsKICAgICAgYXdhaXQgZXhhbS5nZXRFeGFtUmVjb3JkKHRoaXMucXVlcnlJbmZvKS50aGVuKGFzeW5jIHJlc3AgPT4gewogICAgICAgIGlmIChyZXNwLmNvZGUgPT09IDIwMCkgewogICAgICAgICAgYXdhaXQgdGhpcy5nZXRBbGxFeGFtSW5mbygpCiAgICAgICAgICBsZXQgdXNlcklkcyA9IFtdCiAgICAgICAgICByZXNwLmRhdGEuZGF0YS5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgICAgICBpZiAodXNlcklkcy5ldmVyeShpZCA9PiBpZCAhPT0gaXRlbS51c2VySWQpKSB7CiAgICAgICAgICAgICAgdXNlcklkcy5wdXNoKGl0ZW0udXNlcklkKQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgbGV0IHVzZXJJbmZvID0gW10KICAgICAgICAgIGF3YWl0IHVzZXIuZ2V0VXNlckJ5SWRzKHsndXNlcklkcyc6IHVzZXJJZHMuam9pbignLCcpfSkudGhlbihyZXNwID0+IHsKICAgICAgICAgICAgaWYgKHJlc3AuY29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgdXNlckluZm8gPSByZXNwLmRhdGEKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIHJlc3AuZGF0YS5kYXRhLmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRVc2VySW5mbyA9IHVzZXJJbmZvLmZpbmQodSA9PiB1LmlkID09PSBpdGVtLnVzZXJJZCkKICAgICAgICAgICAgaXRlbS50cnVlTmFtZSA9IGN1cnJlbnRVc2VySW5mbz8udHJ1ZU5hbWUKICAgICAgICAgIH0pCiAgICAgICAgICB0aGlzLmV4YW1SZWNvcmRzID0gcmVzcC5kYXRhLmRhdGEKICAgICAgICAgIC8vIOW9k2V4YW1SZWNvcmRz5ZKMZXhhbUluZm/lh4blpIflpb3kuYvlkI7lpITnkIYKICAgICAgICAgIHRoaXMuc2V0RXhhbU5hbWUoKQogICAgICAgICAgdGhpcy50b3RhbCA9IHJlc3AuZGF0YS50b3RhbAogICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgZ2V0QWxsRXhhbUluZm8oKSB7CiAgICAgIGV4YW0uYWxsRXhhbUluZm8oKS50aGVuKChyZXNwKSA9PiB7CiAgICAgICAgaWYgKHJlc3AuY29kZSA9PT0gMjAwKSB7CiAgICAgICAgICB0aGlzLmFsbEV4YW1JbmZvID0gcmVzcC5kYXRhCiAgICAgICAgfQogICAgICB9KQogICAgfSwKICAgIG9wZXJhdGlvbih2KSB7CiAgICAgIGlmICh2ID09PSAnJykgdGhpcy5xdWVyeUluZm8uZXhhbUlkID0gbnVsbAogICAgICB0aGlzLmdldEV4YW1SZWNvcmRzKCkKICAgIH0sCiAgICBzZXRFeGFtTmFtZSgpIHsKICAgICAgdGhpcy5leGFtUmVjb3Jkcy5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgIHRoaXMuYWxsRXhhbUluZm8uZm9yRWFjaChpMiA9PiB7CiAgICAgICAgICBpZiAoaXRlbS5leGFtSWQgPT09IGkyLmV4YW1JZCkgewogICAgICAgICAgICB0aGlzLiRzZXQoaXRlbSwgJ2V4YW1OYW1lJywgaTIuZXhhbU5hbWUpCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICBpZiAoIWl0ZW0uZXhhbU5hbWUpIHsKICAgICAgICAgIHRoaXMuJHNldChpdGVtLCAnZXhhbU5hbWUnLCBjb25zdGFudHMuZGVmYXVsdEV4YW1OYW1lKQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICAvL+WIhumhtemhtemdouWkp+Wwj+aUueWPmAogICAgaGFuZGxlU2l6ZUNoYW5nZSh2YWwpIHsKICAgICAgdGhpcy5xdWVyeUluZm8ucGFnZVNpemUgPSB2YWwKICAgICAgdGhpcy5nZXRFeGFtUmVjb3JkcygpCiAgICB9LAogICAgLy/liIbpobXmj5Lku7bnmoTpobXmlbAKICAgIGhhbmRsZUN1cnJlbnRDaGFuZ2UodmFsKSB7CiAgICAgIHRoaXMucXVlcnlJbmZvLnBhZ2VObyA9IHZhbAogICAgICB0aGlzLmdldEV4YW1SZWNvcmRzKCkKICAgIH0sCiAgICAvL+ajgOafpeaJuemYheaMiemSruaYr+WQpuWxleekugogICAgY2hlY2tNYXJrQnV0dG9uTmVlZFNob3cocmVjb3JkKSB7CiAgICAgIHJldHVybiByZWNvcmQudG90YWxTY29yZSA9PT0gbnVsbCAmJiB0aGlzLmFsbEV4YW1JbmZvCiAgICAgICAgLm1hcChleGFtSW5mbyA9PiBleGFtSW5mby5leGFtSWQpCiAgICAgICAgLmluY2x1ZGVzKHJlY29yZC5leGFtSWQpCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["MarkManage.vue"],"names":[],"mappings":";AAsEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"MarkManage.vue","sourceRoot":"src/views/teacher","sourcesContent":["<template>\n  <el-container>\n    <el-header>\n      <!--操作的下拉框-->\n      <el-select @change=\"operation\" clearable v-model=\"queryInfo.examId\"\n                 placeholder=\"请选择考试\" style=\"margin-bottom: 25px;\">\n        <el-option v-for=\"(item,index) in allExamInfo\" :key=\"index\" :label=\"item.examName\"\n                   :value=\"parseInt(item.examId)\">\n          <span style=\"float: left\">{{ item.examName }}</span>\n        </el-option>\n      </el-select>\n\n    </el-header>\n\n    <el-main>\n      <el-table\n        ref=\"questionTable\"\n        highlight-current-row\n        v-loading=\"loading\"\n        :border=\"true\"\n        :data=\"examRecords\"\n        tooltip-effect=\"dark\"\n        style=\"width: 100%;\">\n\n        <el-table-column align=\"center\" prop=\"examName\" label=\"考试名称\"></el-table-column>\n\n        <el-table-column align=\"center\" prop=\"examTime\" label=\"参考时间\"></el-table-column>\n\n        <el-table-column align=\"center\" prop=\"trueName\" label=\"参考人\"></el-table-column>\n\n        <el-table-column align=\"center\" prop=\"logicScore\" label=\"逻辑题得分\"></el-table-column>\n\n        <el-table-column align=\"center\" label=\"是否批阅\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.totalScore === null ? '未批阅' : '已批阅' }}</span>\n          </template>\n        </el-table-column>\n\n        <el-table-column align=\"center\" label=\"总分\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.totalScore === null ? 0 : scope.row.totalScore }}</span>\n          </template>\n        </el-table-column>\n\n        <el-table-column align=\"center\" label=\"操作\">\n          <template slot-scope=\"scope\">\n            <el-button :type=\"checkMarkButtonNeedShow(scope.row) ? 'primary' : 'warning'\" icon=\"el-icon-view\" size=\"small\"\n                       :disabled=\"!checkMarkButtonNeedShow(scope.row)\"\n                       @click=\"$router.push('/markExam/' + scope.row.recordId)\">\n              {{ checkMarkButtonNeedShow(scope.row) ? '批阅' : '已批阅' }}\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <!--分页-->\n      <el-pagination style=\"margin-top: 25px\"\n                     @size-change=\"handleSizeChange\"\n                     @current-change=\"handleCurrentChange\"\n                     :current-page=\"queryInfo.pageNo\"\n                     :page-sizes=\"[10, 20, 30, 50]\"\n                     :page-size=\"queryInfo.pageSize\"\n                     layout=\"total, sizes, prev, pager, next, jumper\"\n                     :total=\"total\">\n      </el-pagination>\n    </el-main>\n  </el-container>\n</template>\n\n<script>\nimport exam from '@/api/exam'\nimport user from '@/api/user'\nimport constants from '@/utils/constants'\n\nexport default {\n  name: 'MarkManage',\n  data() {\n    return {\n      queryInfo: {\n        pageNo: 1,\n        pageSize: 10\n      },\n      //考试记录\n      examRecords: [],\n      //表格数据加载\n      loading: true,\n      //所有考试信息\n      allExamInfo: [],\n      //总数\n      total: 0\n    }\n  },\n  created() {\n    this.getExamRecords()\n    this.getAllExamInfo()\n  },\n  methods: {\n    async getExamRecords() {\n      await exam.getExamRecord(this.queryInfo).then(async resp => {\n        if (resp.code === 200) {\n          await this.getAllExamInfo()\n          let userIds = []\n          resp.data.data.forEach(item => {\n            if (userIds.every(id => id !== item.userId)) {\n              userIds.push(item.userId)\n            }\n          })\n          let userInfo = []\n          await user.getUserByIds({'userIds': userIds.join(',')}).then(resp => {\n            if (resp.code === 200) {\n              userInfo = resp.data\n            }\n          })\n          resp.data.data.forEach(item => {\n            const currentUserInfo = userInfo.find(u => u.id === item.userId)\n            item.trueName = currentUserInfo?.trueName\n          })\n          this.examRecords = resp.data.data\n          // 当examRecords和examInfo准备好之后处理\n          this.setExamName()\n          this.total = resp.data.total\n          this.loading = false\n        }\n      })\n    },\n    getAllExamInfo() {\n      exam.allExamInfo().then((resp) => {\n        if (resp.code === 200) {\n          this.allExamInfo = resp.data\n        }\n      })\n    },\n    operation(v) {\n      if (v === '') this.queryInfo.examId = null\n      this.getExamRecords()\n    },\n    setExamName() {\n      this.examRecords.forEach(item => {\n        this.allExamInfo.forEach(i2 => {\n          if (item.examId === i2.examId) {\n            this.$set(item, 'examName', i2.examName)\n          }\n        })\n        if (!item.examName) {\n          this.$set(item, 'examName', constants.defaultExamName)\n        }\n      })\n    },\n    //分页页面大小改变\n    handleSizeChange(val) {\n      this.queryInfo.pageSize = val\n      this.getExamRecords()\n    },\n    //分页插件的页数\n    handleCurrentChange(val) {\n      this.queryInfo.pageNo = val\n      this.getExamRecords()\n    },\n    //检查批阅按钮是否展示\n    checkMarkButtonNeedShow(record) {\n      return record.totalScore === null && this.allExamInfo\n        .map(examInfo => examInfo.examId)\n        .includes(record.examId)\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n@import \"../../assets/css/teacher/markManage\";\n</style>\n"]}]}